// ==========================================================================
// Project:  Ember Addons
// Copyright: Â©2011 Capitainetrain and contributors.
// License:   Licensed under MIT license (see license.js)
// ==========================================================================


(function(a){var b=Ember.get,c=Ember.set;Ember.GeoLocation=Ember.Object.extend({autoUpdate:!0,latitude:null,longitude:null,accuracy:null,altitude:null,altitudeAccuracy:null,heading:null,speed:null,timestamp:null,allowHighAccuracy:!1,timeout:Infinity,maximumAge:0,isSupported:"geolocation"in window.navigator,hasLocationBinding:Ember.Binding.bool("timestamp"),init:function(){this._super(),this._provider=this._provider||(navigator.geolocation?navigator.geolocation:(window.google||{}).gears?google.gears.factory.create("beta.geolocation"):null),b(this,"autoUpdate")&&Ember.run.next(this,"autoUpdateDidChange")},updateLocation:function(a){a&&a.isView&&(a=null);if(!b(this,"isSupported")){this.locationUpdateError(null,"Not Supported");return}try{this._provider.getCurrentPosition($.proxy(this,"locationUpdateSuccess"),$.proxy(this,"locationUpdateError"),a?a:b(this,"positionOptions"))}catch(c){this.locationUpdateError(c)}},autoUpdateDidChange:Ember.observer(function(){var a=b(this,"autoUpdate");Ember.none(this._watchOperation)||(this._provider.clearWatch(this._watchOperation),this._watchOperation=null);if(!a)return;if(!b(this,"isSupported")){this.locationUpdateError(null,"Not Supported");return}try{this._watchOperation=this._provider.watchPosition($.proxy(this,"locationUpdateSuccess"),$.proxy(this,"locationUpdateError"),b(this,"positionOptions"))}catch(d){c(this,"autoUpdate",!1),this.locationUpdateError(d)}},"autoUpdate","positionOptions"),locationUpdateSuccess:function(a){this.setProperties({timestamp:a.timestamp,latitude:a.coords.latitude,longitude:a.coords.longitude,accuracy:a.coords.accuracy,altitude:a.coords.altitude,altitudeAccuracy:a.coords.altitudeAccuracy,isError:!1,errorObject:null,heading:typeof a.coords.heading=="undefined"?null:a.coords.heading,speed:typeof a.coords.speed=="undefined"?null:a.coords.speed}),this.locationDidChange()},locationUpdateError:function(a,b){this.setProperties({isError:!0,errorObject:{TIMEOUT:a&&a.code&&a.code===a.TIMEOUT,PERMISSION_DENIED:a&&a.code&&a.code===a.PERMISSION_DENIED,POSITION_UNAVAILABLE:a&&a.code&&a.code===a.POSITION_UNAVAILABLE,message:a&&a.message?a.message:b}})},positionOptions:Ember.computed(function(){return this.getProperties("maximumAge","allowHighAccuracy","timeout")}).property("maximumAge","allowHighAccuracy","timeout").cacheable(),locationDidChange:Ember.K})})({}),function(a){}({})
